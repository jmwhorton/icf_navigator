{% extends "base_header.html" %}
{% block header_title %}{% endblock %}
{% block content %}
<div class="container">
  <h2 class="display-7 fw-bold">{{cf.study_name}}</h2>
  <div class="row g-4 py-5 row-cols-1 row-cols-lg-2">
    <div class="col d-flex align-items-start">
        <div class="icon-square bg-light text-dark flex-shrink-0 me-3">
          <i class="bi fas fa-question-circle fa-2x" style="width:1em;height: 1em"></i>
        </div>
        <div>
          <h2>Answer Questions</h2>
          <p>Here you will answer questions about your study to help us build the consent form for you.</p>
          <a href="{% url 'form' form_id=cf.pk section_id=first_section %}">
            <button type="button" class="btn btn-primary">Continue Survey</button>
          </a>
        </div>
      </div>
    <div class="col d-flex align-items-start">
        <div class="icon-square bg-light text-dark flex-shrink-0 me-3">
          <i class="bi fas fa-print fa-2x" style="width:1em;height: 1em"></i>
        </div>
        <div>
          <h2>PDF Form</h2>
          <p>View the application output in your browser. From here you can save the document as a PDF or print.</p>
          <a href="{% url 'form_print' cf.pk %}">
            <button type="button" class="btn btn-primary">View Form</button>
          </a>
        </div>
      </div>
    </div>
  <div class="row g-4 py-5 row-cols-1 row-cols-lg-2">
    <div class="col">
      <h4>Authorized Users</h4>
      <div class="list-group">
      {% for email in cf.authorized_users.all %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <span>{{email.email}}</span>
          {% if email.email != user.email %}
          <form action="delete" method="post">
            {% csrf_token %}
            <input type="hidden" name="email" value="{{email.email}}"/>
            <button class="badge rounded-pill bg-danger" type="submit" name="save"><i class="fas fa-user-slash"></i></button>
          </form>
          {% endif %}
         </div>
      {% endfor %}
      </div>
      <h4 class="mt-4">Add Additional Authorized Users</h4>
      {% if form.errors %}
      <p>{{form.errors}}</p>
      {% endif %}
      <form method="post">
        {% csrf_token %}
        <div class="form-group">
          <label for="id_email">Email</label>
          <div class="row row-cols-lg-auto">
            <div class="col-12">
              <input class="form-control" type="email" name="email" required="" id="id_email">
            </div>
            <div class="col-12">
              <button class="btn btn-success" type="submit" name="save"><i class="fas fa-user-plus"></i></button>
            </div>
          </div>
        </div>
      </form>
      <p>If you would like to share your form with the developers for the purposes of improving the tool, please add <span style="color: green">share@icf.nav</span> as an authorized user. You can remove this sharing at any time.</p>
    </div>
    <div class="col">
      <h4>Recent Changes</h4>
      <div class="list-group">
      {% for change in recent %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div class="ms-2 me-auto">
            <div class="fw-bold">{{change.question}}</div>
            {{change.user.email}}
          </div>
          <small class="text-muted">{{change.last_change|timesince}}</small>
         </div>
      {% endfor %}
      </div>
    </div>
  </div>
  {% if user.is_superuser %}
  <div class="row mt-3">
    <div class="col-6">
      <ul>
        <li><a href="/debug/json/{{cf.pk}}">JSON Debug Page</a></li>
      </ul>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
