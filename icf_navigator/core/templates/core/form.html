{% extends "base_header.html" %}
{% load static %}
{% block title %}{{consent_form.study_name}}{% endblock %}
{% block header_title %}{{consent_form.study_name}}{% endblock %}
{% block nav_link %}<a class="nav-link text-light" href="{% url 'form_print' consent_form.pk %}">Print</a>{% endblock %}
{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'core/questions.css' %}">
{% endblock %}
{% block content %}
<div class="container-xl">

  <ul class="nav nav-pills nav-fill" role="tablist">
    {% for sec in sections %}
    <li class="nav-item" aria-selected={% if section.pk == sec.pk %}"true"{% else %}"false"{% endif %}>
      <a class="nav-link {% if section.pk == sec.pk %}active{% endif %}" href="{% url 'form' form_id=consent_form.pk section_id=sec.pk %}">{{sec.name}}</a>
     </li>
    {% endfor %}
  </ul>
  <hr>

  <div class="row">
    <div class="col-md-7 col-lg-5">


      <div data-controller="section"
           data-section-index-value="0">
        <div class="d-flex justify-content-between">
          <button class="btn" data-section-target="navbutton" data-action="section#previous"> ← </button>
          <button class="btn" data-section-target="navbutton" data-action="section#next"> → </button>
        </div>

        {% for qgroup in qgroups %}
        <div class="qgroup_container"
             data-section-target="qgroup">

          <h4>{{ qgroup.name }}</h4>
          <div id="question_container">

          {% for question in qgroup.qs %}
            <form
              class="d-flex flex-column"
              data-controller="question"
              data-question-url-value="{% url 'preview' form_id=consent_form.pk section_id=section.pk %}"
              data-question-target="form"
              action="{% url 'question' form_id=consent_form.pk question_id=question.pk %}"
              method="post">
              {% csrf_token %}
              {% if user.is_staff %}
              <div class="text-light">
                <b>{{question.order}}</b>
                <span>{{question.label}}</span>
              </div>
              {% endif %}
              <p>{{question.text}}</p>
              <div>
                {% for field in question.form %}
                {% if field.errors %}
                <div class="question_error">
                  <span>{{field.errors}}</span>
                </div>
                {% endif %}
                <div class="form-group">
                  {% if field.label %}
                  {{ field.label_tag }}
                  {% endif %}
                  <div data-action="change->question#dirty input->question#dirty"
                       class="form_fields">
                    {{ field }}
                  </div>
                </div>
                {% endfor %}
              </div>
              <button data-question-target="save"
                     data-action="question#submit"
                     class="btn btn-primary align-self-end"
                     type="submit"
                     name="save">Save</button>
            </form>
            {% if question.edit_text %}
            <form method="post"
                  data-controller="question"
                  data-question-url-value="{% url 'preview' form_id=consent_form.pk section_id=section.pk %}"
                  data-question-target="form"
                  action="{% url 'edit_text' form_id=consent_form.pk question_id=question.pk %}"
              >
              {% csrf_token %}
              <div data-action="change->question#dirty input->question#dirty">
                <textarea name="text" cols="40" rows="10" class="form-control" required="" id="id_text">{{question.edit_text.text}}</textarea>
              </div>
              <button data-question-target="save"
                     data-action="question#submit"
                     class="btn btn-primary align-self-end"
                     type="submit"
                     name="save">Save</button>
            </form>
            {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
      <div class="d-flex justify-content-between">
        <button class="btn" data-section-target="navbutton" data-action="section#previous"> ← </button>
        <button class="btn" data-section-target="navbutton" data-action="section#next"> → </button>
      </div>
      </div>
    </div>
    <div id="small_preview" class="small_form col-md-5 col-lg-7">
    {% if section.template != "none" %}
      {% include section.template %}
    {% endif %}
    </div>
  </div>
</div>
{% endblock %}
